
# Getting and Cleaning Data (Coursera)
## Course Project CodeBook.md

This file documents the "run_analysis.R" script in this repository, written
as part of the coursera "Getting And Cleaning Data" final course project.

Specifically, this file explains:

1. The input data and variables required to execute the script.
2. The output data and variables generated by the script.
3. The transformations and work performed to produce a final tidy data set.

### Inputs

The "run_analysis.R" script uses the following files in the data set mentioned
above as inputs (all relative to the "UCI HAR Dataset" folder:

| File Name                 | Description                                                                                    |
|---------------------------|------------------------------------------------------------------------------------------------|
| ./activity_labels.txt     | Activiy ID key mapped to textual activity names.                                               |
| ./features.txt            | A list of 561 textual features names, recorded with each measurement of data.                  |
| ./test/y_test.txt         | 2947 rows, each indicating the Activity ID associated with each measurement of test data.      |
| ./test/subject_test.txt   | 2947 rows, each indicating the subject (person) associated with each measurement of test data. |
| ./test/X_test.txt         | 2947 rows, each with 561 features associated with each measurement of test data.               |
| ./train/y_train.txt       | 7352 rows, each indicating the Activity ID associated with each measurement of the train data. |
| ./train/subject_test.txt  | 7352 rows, each indicating the subject (person) associated with each measurement of train data.|
| ./train/X_train.txt       | 7352 rows, each with 561 features associated with each measurement of train data.              |

### Outputs

The "run_analysis.R" script creates the following files as outputs (all
relative to the "UCI HAR Dataset" folder:

| File Name         | Description 
|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ./MergedData.txt  | 10299 rows, representing a merged set of test and train data, with Subject ID, Activity Name, and 561 features or each measurement of data.                 |
| ./TidyData.txt    | 180 rows, representing an independent Tidy data set, with each row as an average of "mean()" and "std()" variables, for each activity, for each subject ID. |

### Transformation of the Inputs

* Read the "activity_labels.txt" file.  This table helps to map activity-codes
  to human readable activity names.

| Variable                             | Description                                         |
|--------------------------------------|-----------------------------------------------------|
| ActivityId                           | The id of the activity a record represents.         |
| ActivityName                         | The human readable activity a record represents.    |
```
    activityLabels <- read.csv(
        "./activity_labels.txt",
        header = FALSE,
        sep = " ",
        col.names=list("ActivityId", "ActivityName"))
```
* Read the "features.txt" file.  This table contains (most of) the column 
  names associated with the measurements in our data set.

| Variable                             | Description                                         |
|--------------------------------------|-----------------------------------------------------|
| FeatureColId                         | The id of the feature a record represents.          |
| FeatureColName                       | The human readable feature name a record represents.| 
```
    featuresColNames <- read.csv(
        "./features.txt",
        header = FALSE,
        sep = " ",
        col.names=list("FeatureColId", "FeatureColName"))
```
* Read the "./test/y_test.txt" and "./train/y_train.txt" files.  These tables
  identify the activity associated with each measurement in the test and train 
    data sets. With these tables:
  * Label all of the activities with their textual counterparts.
  * Merge the test and train rows together.
  * Add a measurement-id we'll use to join things later.

| Variable                             | Description                                         |
|--------------------------------------|-----------------------------------------------------|
| ActivityId                           | The id of the activity a record represents.         |
```
    testActivityRows <- read.csv(
        "./test/y_test.txt",
        header = FALSE,
        sep = " ",
        col.names=list("ActivityId"))

    trainActivityRows <- read.csv(
        "./train/y_train.txt",
        header = FALSE,
        sep = " ",
        col.names=list("ActivityId"))

    # Label all of the activities with their textual counterparts.
    testActivityRows   <- activityLabels[testActivityRows$ActivityId,]
    trainActivityRows  <- activityLabels[trainActivityRows$ActivityId,]

    # Merge the test and train rows together.
    # Add a measurement-id column we'll use to join things later.
    mergedActivityRows <- rbind(testActivityRows, trainActivityRows)
    mergedActivityRows$measurementId <- 1:nrow(mergedActivityRows)
```
* Read the "./test/X_test.txt" and "./train/X_train.txt" files.  These tables
  identify the features associated with each measurement in the test and train 
  data sets.  Note: Use the "readr" package, for much faster file i/o.
  * Subset to only the columns labelled as "mean()" or "std()" of measurements.
  * Merge the test and train rows together.
  * Add a measurement-id we'll use to join things later.

  Note: These tables have a column for every row in the "features.txt" file 
        above.
```
    testFeaturesRows <- read_fwf(
        "./test/X_test.txt", 
        col_positions = fwf_widths(
            widths = rep(16,561),
            col_names=featuresColNames$FeatureColName))

    trainFeaturesRows <- read_fwf(
        "./train/X_train.txt", 
        col_positions = fwf_widths(
            widths = rep(16,561),
            col_names=featuresColNames$FeatureColName))

    # Subset to only the columns labelled as "mean()" or "std()" of measurements.
    testFeaturesRows  <- testFeaturesRows[
        ,grep("(-mean\\(\\)|-std\\(\\))", names(testFeaturesRows))]

    trainFeaturesRows <- trainFeaturesRows[
        ,grep("(-mean\\(\\)|-std\\(\\))", names(trainFeaturesRows))]

    # Merge the test and train rows together.
    # Add a measurement-id column we'll use to join things later.
    mergedFeaturesRows <- rbind(testFeaturesRows, trainFeaturesRows)
    mergedFeaturesRows$measurementId <- 1:nrow(mergedFeaturesRows)
```
* Build the merged data set (built from the test and train data sets.
  * Join subject rows, activity rows, and features rows.
  * Write the merged data set into its own file, for later use.
```
    # Join subject rows, activity rows, and feature rows.
    mergedData <- join_all(
        list(mergedSubjectRows, mergedActivityRows, mergedFeaturesRows))

    # Write the merged data set into its own file, for later use.
    write.table(mergedData, "./MergedData.txt", sep = ",", row.names = FALSE)
```
* Build a tidy data set, which is an aggregate of the original merged data set,
  rolled up as an average for each variable, for each activity and each subject.
  * Create a copy of the merged data set.
  * Mark some columns for eventual deleting.
  * Create a tidy data set, rolled up as an average of each variable, for each
    activity, and each subject.
  * Remove columns we no longer need.
  * Rename certain column names of the tidy data set to reflect their new
    meaning.
  * Write the tidy data set into its own file, for later use.
```
    # Create a copy of the merged data set.
    mergedDataCopy <- mergedData

    # Mark some columns for eventual deletion.
    colnames(mergedDataCopy)[
        colnames(mergedDataCopy) == "ActivityName"] <- "tempActName"
    colnames(mergedDataCopy)[
        colnames(mergedDataCopy) == "SubjectId"] <- "tempSubjId"

    # Create a tidy data set, rolled up as an average of each variable, for each
    # activity, and each subject.
    tidyData <- aggregate(
        mergedDataCopy,
        list(ActivityName = mergedDataCopy$tempActName, 
             SubjectId = mergedDataCopy$tempSubjId),
        mean)

    # Remove columns we no longer need.
    tidyData$measurementId <- NULL
    tidyData$ActivityId <- NULL
    tidyData$tempSubjId <- NULL
    tidyData$tempActName <- NULL

    # Rename certain column names of the tidy data set to reflect their new meaning.
    colnames(tidyData) <- ifelse(
        colnames(tidyData) == "SubjectId" | colnames(tidyData) == "ActivityName", 
        colnames(tidyData),
        paste("MeanOf:[", colnames(tidyData), "]", sep=""))

    # Write the tidy data set into its own file, for later use.
    write.table(tidyData, "./TidyData.txt", sep = ",", row.names = FALSE)
```

### Description of Tidy Data Set

| Variable                             | Description                                                       |
|--------------------------------------|-------------------------------------------------------------------|
| SubjectId                            | The id of the subject (person) a record represents.               |
| ActivityName                         | The activity being performed by the subject.                      |
| MeanOf:[tBodyAcc-mean()-X]           | Mean of time domain body X accel means.                           |
| MeanOf:[tBodyAcc-mean()-Y]           | Mean of time domain body Y accel means.                           |
| MeanOf:[tBodyAcc-mean()-Z]           | Mean of time domain body Y accel means.                           |
| MeanOf:[tBodyAcc-std()-X]            | Mean of time domain body X accel standard deviations.             |
| MeanOf:[tBodyAcc-std()-Y]            | Mean of time domain body Y accel standard deviations.             |
| MeanOf:[tBodyAcc-std()-Z]            | Mean of time domain body Z accel standard deviations.             |                                               |
| MeanOf:[tGravityAcc-mean()-X]        | Mean of time domain gravity X accel means.                        |
| MeanOf:[tGravityAcc-mean()-Y]        | Mean of time domain gravity Y accel means.                        |
| MeanOf:[tGravityAcc-mean()-Z]        | Mean of time domain gravity Z accel means.                        |
| MeanOf:[tGravityAcc-std()-X]         | Mean of time domain gravity X accel standard deviations.          |
| MeanOf:[tGravityAcc-std()-Y]         | Mean of time domain gravity Y accel standard deviations.          |
| MeanOf:[tGravityAcc-std()-Z]         | Mean of time domain gravity Z accel standard deviations.          |
| MeanOf:[tBodyAccJerk-mean()-X]       | Mean of time domain body X accel jerk means.                      |
| MeanOf:[tBodyAccJerk-mean()-Y]       | Mean of time domain body Y accel jerk means.                      |
| MeanOf:[tBodyAccJerk-mean()-Z]       | Mean of time domain body Z accel jerk means.                      |
| MeanOf:[tBodyAccJerk-std()-X]        | Mean of time domain body X accel jerk standard deviations.        |
| MeanOf:[tBodyAccJerk-std()-Y]        | Mean of time domain body Y accel jerk standard deviations.        |
| MeanOf:[tBodyAccJerk-std()-Z]        | Mean of time domain body Z accel jerk standard deviations.        |
| MeanOf:[tBodyGyro-mean()-X]          | Mean of time domain body X gyro means.                            |
| MeanOf:[tBodyGyro-mean()-Y]          | Mean of time domain body Y gyro means.                            |
| MeanOf:[tBodyGyro-mean()-Z]          | Mean of time domain body Z gyro means.                            |
| MeanOf:[tBodyGyro-std()-X]           | Mean of time domain body X gyro standard deviations.              |
| MeanOf:[tBodyGyro-std()-Y]           | Mean of time domain body Y gyro standard deviations.              |
| MeanOf:[tBodyGyro-std()-Z]           | Mean of time domain body X gyro standard deviations.              |
| MeanOf:[tBodyGyroJerk-mean()-X]      | Mean of time domain body X gyro jerk means.                       |
| MeanOf:[tBodyGyroJerk-mean()-Y]      | Mean of time domain body Y gyro jerk means.                       |
| MeanOf:[tBodyGyroJerk-mean()-Z]      | Mean of time domain body Z gyro jerk means.                       |
| MeanOf:[tBodyGyroJerk-std()-X]       | Mean of time domain body X gyro jerk standard deviations.         |                                               |
| MeanOf:[tBodyGyroJerk-std()-Y]       | Mean of time domain body Y gyro jerk standard deviations.         |
| MeanOf:[tBodyGyroJerk-std()-Z]       | Mean of time domain body Z gyro jerk standard deviations.         |
| MeanOf:[tBodyAccMag-mean()]          | Mean of time domain body accel magnitude means.                   |
| MeanOf:[tBodyAccMag-std()]           | Mean of time domain body accel magnitude standard deviations.     |                                               |
| MeanOf:[tGravityAccMag-mean()]       | Mean of time domain gravity accel magnitude means.                |
| MeanOf:[tGravityAccMag-std()]        | Mean of time domain gravity accel magnitude standard deviations.  |
| MeanOf:[tBodyAccJerkMag-mean()]      | Mean of time domain body accel jerk magnitude means.              |
| MeanOf:[tBodyAccJerkMag-std()]       | Mean of time domain body accel jerk magnitude standard deviations.|
| MeanOf:[tBodyGyroMag-mean()]         | Mean of time domain body gyro magnitude means.                    |
| MeanOf:[tBodyGyroMag-std()]          | Mean of time domain body gyro magnitude standard deviations.      |
| MeanOf:[tBodyGyroJerkMag-mean()]     | Mean of time domain body gyro jerk magnitude means.               |
| MeanOf:[tBodyGyroJerkMag-std()]      | Mean of time domain body gyro jerk magnitude standard deviations. |
| MeanOf:[fBodyAcc-mean()-X]           | Mean of fqcy domain body X accel means.                           |
| MeanOf:[fBodyAcc-mean()-Y]           | Mean of fqcy domain body Y accel means.                           |
| MeanOf:[fBodyAcc-mean()-Z]           | Mean of fqcy domain body Z accel means.                           |
| MeanOf:[fBodyAcc-std()-X]            | Mean of fqcy domain body X accel standard deviations.             |
| MeanOf:[fBodyAcc-std()-Y]            | Mean of fqcy domain body Y accel standard deviations.             |
| MeanOf:[fBodyAcc-std()-Z]            | Mean of fqcy domain body Z accel standard deviations.             |
| MeanOf:[fBodyAccJerk-mean()-X]       | Mean of fqcy domain body X jerk means.                            |
| MeanOf:[fBodyAccJerk-mean()-Y]       | Mean of fqcy domain body Y accel jerk means.                      |
| MeanOf:[fBodyAccJerk-mean()-Z]       | Mean of fqcy domain body Z accel jerk means.                      |
| MeanOf:[fBodyAccJerk-std()-X]        | Mean of fqcy domain body X accel jerk standard deviations.        |
| MeanOf:[fBodyAccJerk-std()-Y]        | Mean of fqcy domain body Y accel jerk standard deviations.        |
| MeanOf:[fBodyAccJerk-std()-Z]        | Mean of fqcy domain body Z accel jerk standard deviations.        |
| MeanOf:[fBodyGyro-mean()-X]          | Mean of fqcy domain body X gyro means.                            |
| MeanOf:[fBodyGyro-mean()-Y]          | Mean of fqcy domain body Y gyro means.                            |
| MeanOf:[fBodyGyro-mean()-Z]          | Mean of fqcy domain body Z gyro means.                            |
| MeanOf:[fBodyGyro-std()-X]           | Mean of fqcy domain body X gyro standard deviations.              |
| MeanOf:[fBodyGyro-std()-Y]           | Mean of fqcy domain body Y gyro standard deviations.              |
| MeanOf:[fBodyGyro-std()-Z]           | Mean of fqcy domain body Z gyro standard deviations.              |
| MeanOf:[fBodyAccMag-mean()]          | Mean of fqcy domain body accel magnitude means.                   |
| MeanOf:[fBodyAccMag-std()]           | Mean of fqcy domain body accel magnitude standard deviations.     |
| MeanOf:[fBodyBodyAccJerkMag-mean()]  | Mean of fqcy domain body accel jerk magnitude means.              |
| MeanOf:[fBodyBodyAccJerkMag-std()]   | Mean of fqcy domain body accel jerk magnitude standard deviations.|
| MeanOf:[fBodyBodyGyroMag-mean()]     | Mean of fqcy domain body gyro magnitude means.                    |
| MeanOf:[fBodyBodyGyroMag-std()]      | Mean of fqcy domain body gyro magnitude standard deviations.      |
| MeanOf:[fBodyBodyGyroJerkMag-mean()] | Mean of fqcy domain body gyro jerk magnitude means.               |
| MeanOf:[fBodyBodyGyroJerkMag-std()]  | Mean of fqcy domain body gyro jerk magnitude standard deviations. |
